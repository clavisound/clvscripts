#!/bin/bash
# wait for usbmuxd
sleep 3

if [ $1 -gt 0 ]; then
	sleep 3;
fi

FILE=/var/log/iOS.GasGauge

sleep 3
MESSAGE=$(ideviceinfo --simple | grep DeviceName)
MESSAGE+=","
MESSAGE+=`date -R`
for i in $(idevicediagnostics diagnostics GasGauge | grep integer | sed -e 's+.*<integer>+,+' -e 's+</int.*++')
do
	MESSAGE+=$i
done

echo -e $MESSAGE >> $FILE
# DEBUG
# echo -e $MESSAGE
